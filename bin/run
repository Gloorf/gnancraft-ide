#!/bin/bash

set -ex

if [[ "$1" == help ]] ; then
  echo "usage: $(basename $0) [dev|stop|help] [dockers args]"
  exit 0
fi

COMMON_ARGS="--detach=true --name=scedit -p 127.0.0.1:5000:5000 --volumes-from gnandata -e SRCDIR=/data/scriptcraft/players -e SECRET=secret scedit"

if [[ "$1" == dev ]] ; then
  ARGS="-v $(perl -MCwd=realpath -e "print realpath '$PWD'"):/usr/src/app -e DEBUG=y"
  shift
fi

if $(docker ps -a | grep scedit >/dev/null) ; then
  docker stop scedit
  docker rm -v scedit
fi

if [[ "$1" != stop ]] ; then
  docker run $ARGS $COMMON_ARGS $@
fi

