#!/bin/bash

set -ex

if [[ "$1" == help ]] ; then
  echo "usage: $(basename $0) [-c config] [dev|stop|help] [dockers args]"
  exit 0
fi

if [[ "$1" == -c ]] ; then
  shift
  source $1
  shift
else
  scedit_container=scedit
  scedit_port=5000
  data_container=gnandata
fi

COMMON_ARGS="--detach=true --name=${scedit_container} -p 127.0.0.1:${scedit_port}:5000 --volumes-from ${data_container} -e SRCDIR=/data/scriptcraft/players -e SECRET=secret scedit"

if [[ "$1" == dev ]] ; then
  ARGS="-v $(perl -MCwd=realpath -e "print realpath '$PWD'"):/usr/src/app -e DEBUG=y"
  shift
fi

if $(docker ps -a | grep "\b${scedit_container} *$" >/dev/null) ; then
  docker stop $scedit_container
  docker rm -v $scedit_container
fi

if [[ "$1" != stop ]] ; then
  docker run $ARGS $COMMON_ARGS $@
fi

