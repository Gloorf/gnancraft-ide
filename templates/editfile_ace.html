<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Editing {{fname}}</title>

    <style type="text/css" media="screen">
    body {
        overflow: hidden;
    }
    #editor { 
        margin: 0;
        position: absolute;
        top: 120;
        bottom: 0;
        left: 0;
        right: 0;
    }
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
    <script src="/static/beautify.js">
    </script>
  </head>

  <body>
<p><b>Editing {{fname}}</b>
<span id="status">
{% if not can_save %}
(not yours)
{% else %}
(saved)
{% endif %}
</span>
</p>
<p> <a href="/edit/">Back</a>
<p>
<input type='button' 
{% if not can_save %}
disabled
{% endif %}
onclick='submitText()' value='Save'/>
<input type='button' onclick='clean()' value='Clean'/>
</p>

<form name="editform" id="editform" action="/edit/{{fname}}" method="POST">
<input type="hidden" id="form_text" name="text" value="">
</form>

<pre id="editor">{{content}}
</pre>



<script src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
function clean() {
  editor.setValue(js_beautify(editor.getValue()));
}

function submitText()
{
   var txt=editor.getValue();
   var action = document.getElementById("editform").action;
   jQuery.post(action, { text : txt }, 
      function(data, txtStatus) {
         document.getElementById("status").innerHTML = "(saved)";
      }
   );
}

var editor = ace.edit("editor");
{% if not can_save %}
editor.setReadOnly(true);
{% endif %}
editor.setTheme("ace/theme/twilight");
editor.getSession().setMode("ace/mode/javascript");
document.getElementById('editor').style.fontSize='18px';

{% if can_save %}
editor.getSession().on('change', function(e) {
   document.getElementById("status").innerHTML = "(altered)";
});
{% endif %}
</script>

  </body>
</html>
